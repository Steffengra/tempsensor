<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.11"/>
<title>tempsensor: Dokumentation</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { init_search(); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">tempsensor
   </div>
   <div id="projectbrief">Arduino Temperature Sensor w/ GUI</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.11 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li class="current"><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
</div><!-- top -->
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">Dokumentation </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h1><a class="anchor" id="Zielsetzung"></a>
Zielsetzung</h1>
<p>Der im letzten Semester als Beispiel zur Nutzung kleiner Elektronikbauteile etwa in SmartHome-Anwendungen gebaute Arduino-Temperatursensor sollte mit serieller Kommunikation und einer graphischen Oberfläche erweitert werden. Er bietet nun die erstellung eines Logfiles, graphische Ausgabe der Messergebnisse und des Temperatur-LED Zustandes, direkte Anpassung der Messfrequenz im laufenden Betrieb sowie live-Synchronisation des Datums mit einem verbundenen Server, was über lange Messzeiträume deutlich genauere Messprotokollierung ermögllicht. Weiterhin vorhandene Features sind die Ausgabe der Messwerte direkt am Arduino über eine LED und in Textform auf einem LCD und Messung der Luftfeuchtigkeit.</p>
<p>Zur Umsetzung genutzt wurden ein Arduino UNO board, ein LCD, ein DHT11 Temperatur- und Feuchtigkeitssensor, eine RGB-LED, ein Laptop und ein Verbindungskabel.</p>
<h1><a class="anchor" id="a"></a>
How-to: Aufbau und Inbetriebnahme</h1>
<div class="image">
<img src="aufbau.jpg" alt="aufbau.jpg"/>
<div class="caption">
Abbildung 1</div></div>
<p> Abbildung 1 zeigt ein Bild des Aufbaus. Folgendes muss verbunden werden:</p><ul>
<li>DHT11-Sensor: drei Pins (vlnr)<ul>
<li>Sensor -&gt; Digitaler Arduino Port, standardmäßig 10</li>
<li>VCC -&gt; Power Arduino Port (5V)</li>
<li>GND -&gt; GND</li>
</ul>
</li>
<li>LCD: Vier Pins<ul>
<li>GND -&gt; GND</li>
<li>VCC -&gt; Power Arduino Port (5V)</li>
<li>SDA -&gt; Analoger Arduino Port, standardmäßig A4</li>
<li>SCL -&gt; Analoger Arduino Port, standardmäßig A5</li>
</ul>
</li>
<li>RGB-LED: vier Pins (vlnr)<ul>
<li>R -&gt; Digitaler Arduino Port mit PWM, standardmäßig 6</li>
<li>G -&gt; Digitaler Arduino Port mit PWM, standardmäßig 5</li>
<li>B -&gt; Digitaler Arduino Port mit PWM, standardmäßig 3</li>
<li>GND -&gt; GND</li>
</ul>
</li>
</ul>
<p>Anschliessend muss das Arduino noch über die serielle Schnittstelle mit einem Rechner verbunden und der tempsensor-code auf diesem Rechner ausgeführt werden.</p>
<p>Nun wird der Arduino in bestimmten Intervallen (voreingestellt eine Sekunde, über die GUI veränderbar) Messwerte ermitteln, und alle 5 Intervalle synchronisieren sich die Geräte. Gleichzeitig zeigt das LCD die letzten ermittelten 5-Intervall-Durchschnittswerte und die LED interpretiert diese in Farbe und Intensität.</p>
<h1><a class="anchor" id="Umsetzung"></a>
Umsetzung</h1>
<p>Der auskommentierte Quellcode befindet sich im Ordner "Temperatursensor" (Arduino-code) bzw "tempsensor" (QT-code) und auf <a href="https://github.com/Steffengra/tempsensor">Github</a>. Dort wird in größerem Detail auf die Funktionsweise eingegangen.</p>
<p>Die größte Hürde bei der Erweiterung des Projektes war die serielle Kommunikation. Glücklicherweise bietet QT eine Klasse QSerialPort, welche die serielle Kommunikation deutlich vereinfacht. Ein Objekt dieser Klasse wird erstellt und mit den entsprechenden Informationen, die sie zum Verbinden mit dem Arduino benötigt, versorgt. Dieses Objekt mit seinen Funktionen wirkt im Weiteren dann als Schnittstelle, über die unser Quellcode die serielle Schnittstelle bearbeiten kann. Wir entschieden uns für ein Synchronisationsmodell, in dem beide verbundenen Geräte bis auf eine Ausnahme nur zu bestimmten Zeitpunkten miteinander kommunizieren und durch bestimmte bekannte keywords ihre jeweilige Absicht ausdrücken. Sendet bspw. das Arduino "sync", so ist dies das Signal für den Server, dass der Arduino bereit für die synchronisation der Uhrzeit ist. Das Arduino weiss wiederum, dass danach bestimmte Daten in einer bestimmten Form mit Sicherheits-bits zu erwarten sind usw., es gibt also ein Kommunikations-Protokoll. Um das Überwachen der seriellen Schnittstelle auf eingehende Kommunikation durch den Arduino kümmert sich ein Thread, welcher bei Empfang von Daten ein Signal aussendet, um das sich der Hauptthread dann per Slot kümmern kann.</p>
<p>Das Erstellen der graphischen Oberfläche war nicht weiter problematisch. Das UI ist größtenteils passiv. Ausnahme ist die Möglichkeit, das Messintervall live zu ändern. Wird das Intervall vom User geändert, so geschieht dies direkt und wird vom Arduino vor der nächsten Synchronisation bearbeitet.</p>
<h1><a class="anchor" id="b"></a>
To-do: Probleme und mögliche Erweiterungen</h1>
<p>Im letzten Semester war das größte Problem der Anwendung die auf lange Zeit ungenaue interne Zeitberechnung des Arduino. Dieses Problem konnte durch die Synchronisation mit dem Server gelöst werden.</p>
<p>Insgesamt ist das UI etwas spartanisch geraten und könnte leicht verschönert und verbessert werden. Obwohl die serielle Kommunikation in unseren Tests keine Probleme verursachte, so kann diese sicherlich deutlich robuster gestaltet werden. Auch die permanente Verbindung per Kabel ist nicht ideal für eine realistische SmartHome-Anwendung.</p>
<p>Insgesamt ist dieses Projekt natürlich beliebig erweiterbar und insbesondere verbesserbar. </p>
</div></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.11
</small></address>
</body>
</html>
